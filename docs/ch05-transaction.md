## 트랜잭션

트랜잭션은 하나의 논리적인 작업 셋에 쿼리 개수에 관계없이 전체가 적용되거나 적용되지 않음을 보장한다.

여기서 쿼리개수가 상관없는 이유는 트랜잭션이 보장되는 MySQL 엔진과, 보장되지 못하는 엔진에서 차이를 볼 수 있다.

<a href="../src/transaction_diff_by_engine.sql">트랜잭션 체험</a>

위의 코드를 실행해보면, 명시적인 트랜잭션을 적지 않았어도, INNODB 엔진과 MYISAM 엔진에서 차이를 볼 수 있다.

INNODB 엔진은 트랜잭션을 보장하기 때문에, `fdpk`가 `3`인 값에 대한 INSERT 문 실패는 전체 실패로 이어진다.

하지만 MYISAM 엔진은 트랜잭션을 보장하지 않기 때문에, `fdpk`가 `3`인 값에 대한 실패를 제외하면 나머지 INSERT 는 성공했음을 볼 수 있다.

이러한 특징을 원자성(Atomic)이라고 하는데, 그밖에 트랜잭션의 커밋 전과 후에 대해서 테이블 구조의 변화나 관계에 변화가 없어야 한다는 일관성(Consistency)과

서로다른 두 트랜잭션 사이 간섭이 없어야 한다 는 고립성(Isolation), 마지막으로 천재지변이 일어나지 않는이상 커밋된 데이터는 영구적으로 보관되어야 한다라는 영구성(Durability)이 있다.

### 트랜잭션의 주의사항

사용자 코드에서 트랜잭션의 범위를 `최소화` 하는것이 중요하다.

왜냐하면 트랜잭션을 수행한다는 것은 트랜잭션내에 수행하는 쿼리에 따라 다르지만 레코드에 잠금을 걸 수도 있다는 것이며,

그 트랜잭션 내에 굳이 DB에서 수행되는것이 아니며, 오래걸리는 작업이 있다면 쓸데없이 트랜잭션을 오래동안 유지하고 있게 되며, 이는 곧 다른 트랜잭션내에 잠금해제를 기다릴수도 있다.



