## Double Write Buffer

어떤 변경사항이 생기면 버퍼풀 내의 `리두로그`와 `더티 페이지`에 기록이 된다.

여기서 리두로그의 체크포인트 발생 혹은 백그라운드 스레드에 의한 주기적인 디스크 플러시 발생시 디스크로 내용이 쓰여지는데,

플러시 도중에 문제가 발생하여 강제종료 된 경우, 페이지 일부만이 최신화 된 것을 `파셜 페이지` 혹은 `톤 페이지`라고한다.

이런 상황을 막기위해, InnoDB 스토리지 엔진은 디스크 플러시 전 더티페이지의 변경사항들을 묶어서 `시스템 테이블스페이스의 Double Write Buffer에 저장`한다.

만약 Double Write Buffer를 시스템변수 `innodb_doublewrite`로 설정되어 있다면, 

InnoDB 스토리지 엔진이 재시작될 때 데이터 파일과 `Double Write Buffer`를 비교하여 다른 내용이 있다면 Double Write 버퍼의 내용을 복사해서 넣는다.

물론 HDD와 같이 원판회전 시스템을 가진 하드웨어에서는 무리가 없지만, SSD같이 랜덤 I/O와 순차적 I/O가 차이가 없는 하드웨어에서는 성능에 부담이 될 수 있다.

그렇다고 해도 데이터의 무결성이 매우 중요한 상황에서는 용하는것이 좋다.

## 언두 로그

MVCC를 구현하며 트랜잭션과 격리수준을 보장해주는 로그이다.

언두로그는 말그대로 격리수준을 보장하기 위해 트랜잭션 두가지가 동시에 시작하여 수정을 발생시킨 트랜잭션이 먼저 커밋되더라도

`REPEATABLE_READ`의 격리수준을 보장하는 세션에서는 트랜잭션상 레코드의 수정전 데이터를 반복해서 읽을 수 있어야 하기 때문에 언두로그가 필요하다.

그리고 롤백이 발생하면 언두로그를 따라서 마지막 체크포인트 혹은 커밋시점으로 되돌아가야한다.

그러면 여기서 계속 열려있는 트랜잭션이 발생할 경우, 격리수준과 트랜잭션을 보장하기 위해서 계속 언두로그가 확장 될 것인가?

우선 언두로그가 저장되는 공간을 `언두 테이블 스페이스`라고 한다.

예전에는 별도의 테이블로 관리되었다가, 8.0에서는 무조건 언두로그 파일로서 관리되는걸로 개선되다.



